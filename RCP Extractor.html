<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RCP Extractor - Astro-Nyan Ultimate</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;800&family=JetBrains+Mono:wght@400;700&family=Sarabun:wght@400;600&display=swap" rel="stylesheet">
    
    <style>

        
        :root {
            /* Universe Palette */
            --bg-deep: #02020a;
            --glass-surface: rgba(20, 20, 35, 0.5);
            --glass-border: rgba(100, 200, 255, 0.1);
            --neon-cyan: #00f2ff;
            --neon-pink: #ff00de;
            --text-main: #ffffff;
            --text-muted: #8b9bb4;
            
            --font-ui: 'Outfit', 'Sarabun', sans-serif;
            --font-code: 'JetBrains Mono', monospace;
        }

        body {
            margin: 0; height: 100vh; background-color: var(--bg-deep); color: var(--text-main);
            font-family: var(--font-ui); overflow: hidden; display: flex; justify-content: center; align-items: center; user-select: none;
        }

        /* --- Scrollbar --- */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: rgba(0,0,0,0.3); border-radius: 4px; }
        ::-webkit-scrollbar-thumb { background: linear-gradient(180deg, var(--neon-cyan), var(--neon-pink)); border-radius: 4px; box-shadow: 0 0 10px var(--neon-cyan); }
        ::-webkit-scrollbar-thumb:hover { background: linear-gradient(180deg, #fff, var(--neon-cyan)); }

        /* --- Background Layers --- */
        #starCanvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: -10; }
        .nebula { position: absolute; width: 100vw; height: 100vh; background: radial-gradient(circle at 20% 80%, rgba(255, 0, 222, 0.1), transparent 40%), radial-gradient(circle at 80% 20%, rgba(0, 242, 255, 0.1), transparent 40%); z-index: -9; animation: nebulaPulse 10s infinite alternate; }
        @keyframes nebulaPulse { 0% { opacity: 0.5; } 100% { opacity: 0.8; } }

        /* --- CSS ASTRO-NYAN LAYER (Background) --- */
        #astroLayer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: -5; overflow: hidden; }
        
        /* Container for the floating animation */
        .astro-nyan-wrapper {
            position: absolute;
            will-change: transform;
            /* Default Size Override by JS */
            width: 150px; height: 180px; 
        }

        /* =========================================
           CSS ART: THE ASTRO-NYAN (Detailed Code)
           ========================================= */
        .nyan-box { width: 100%; height: 100%; position: relative; transform-style: preserve-3d; }

        /* 1. Jetpack */
        .jetpack {
            position: absolute; top: 30%; left: 5%; width: 90%; height: 50%;
            background: #95a5a6; border-radius: 20px; z-index: 1;
            box-shadow: inset -5px -5px 15px rgba(0,0,0,0.3);
            border: 2px solid #7f8c8d;
        }
        .thruster { position: absolute; bottom: -10px; width: 25px; height: 15px; background: #34495e; border-radius: 4px; }
        .thruster.left { left: 15px; } .thruster.right { right: 15px; }
        
        /* Flames (Animated) */
        .flame {
            position: absolute; top: 100%; width: 18px; height: 30px;
            background: linear-gradient(to bottom, #f1c40f, #e74c3c, transparent);
            border-radius: 0 0 10px 10px; opacity: 0.8;
            animation: burn 0.1s infinite alternate;
        }
        .flame.left { left: 18px; } .flame.right { right: 18px; animation-delay: 0.05s; }
        @keyframes burn { 0% { height: 30px; transform: scaleX(1); } 100% { height: 45px; transform: scaleX(0.8); } }

        /* 2. Body Suit */
        .suit-body {
            position: absolute; top: 35%; left: 15%; width: 70%; height: 50%;
            background: #ecf0f1; border-radius: 40px; z-index: 5;
            box-shadow: inset -10px -5px 20px rgba(0,0,0,0.1);
            border: 3px solid #bdc3c7;
        }
        .chest-panel {
            position: absolute; top: 40%; left: 25%; width: 50%; height: 20px;
            background: linear-gradient(90deg, var(--neon-cyan), var(--neon-pink));
            border-radius: 6px; box-shadow: 0 0 10px var(--neon-cyan);
            animation: panelGlow 2s infinite alternate;
        }
        @keyframes panelGlow { 0% { opacity: 0.6; } 100% { opacity: 1; } }

        /* 3. Limbs */
        .limb {
            position: absolute; background: #ecf0f1; border: 3px solid #bdc3c7; border-radius: 15px; z-index: 4;
        }
        .arm { width: 25px; height: 50px; top: 40%; }
        .arm.left { left: 0; transform: rotate(30deg); transform-origin: top right; animation: waveLeft 3s infinite ease-in-out; }
        .arm.right { right: 0; transform: rotate(-30deg); transform-origin: top left; animation: waveRight 4s infinite ease-in-out; }
        .leg { width: 25px; height: 40px; bottom: 0; z-index: 3; }
        .leg.left { left: 25%; } .leg.right { right: 25%; }

        @keyframes waveLeft { 0%, 100% { transform: rotate(30deg); } 50% { transform: rotate(50deg); } }
        @keyframes waveRight { 0%, 100% { transform: rotate(-30deg); } 50% { transform: rotate(-50deg); } }

        /* 4. Helmet & Head */
        .helmet {
            position: absolute; top: 0; left: 5%; width: 90%; height: 50%;
            background: #ecf0f1; border-radius: 50%; z-index: 10;
            border: 4px solid #bdc3c7;
            overflow: hidden;
            box-shadow: inset -5px -10px 15px rgba(0,0,0,0.2);
        }
        
        .visor-glass {
            position: absolute; top: 10%; left: 10%; width: 80%; height: 80%;
            background: linear-gradient(135deg, rgba(20,20,50,0.8), rgba(0,0,0,0.9));
            border-radius: 50%;
            border: 3px solid #95a5a6;
            overflow: hidden;
            z-index: 11;
        }
        .reflection {
            position: absolute; top: 15%; left: 15%; width: 25%; height: 15%;
            background: rgba(255,255,255,0.6); border-radius: 50%;
            transform: rotate(-45deg); z-index: 20;
        }

        /* 5. The Cat Face (Inside Visor) */
        .cat-head {
            position: absolute; bottom: -5px; left: 15%; width: 70%; height: 75%;
            background: #e67e22; /* Orange Cat */
            border-radius: 40% 40% 45% 45%;
            z-index: 12;
        }
        /* Ears */
        .cat-ears { position: absolute; top: -15px; width: 100%; height: 30px; }
        .ear {
            position: absolute; bottom: 0; width: 0; height: 0;
            border-left: 15px solid transparent; border-right: 15px solid transparent;
            border-bottom: 25px solid #e67e22;
        }
        .ear.left { left: 0; transform: rotate(-20deg); }
        .ear.right { right: 0; transform: rotate(20deg); }

        /* Stripes (ลายแมวส้ม) */
        .stripe {
            position: absolute; top: 5px; left: 50%; transform: translateX(-50%);
            width: 0; height: 0;
            border-left: 5px solid transparent; border-right: 5px solid transparent;
            border-top: 15px solid #d35400;
        }

        /* Face Features */
        .face-features { position: absolute; top: 35%; width: 100%; text-align: center; }
        
        /* Eyes (Blinking & Moving) */
        .eyes-row { display: flex; justify-content: center; gap: 15px; }
        .eye {
            width: 14px; height: 14px; background: #000; border-radius: 50%;
            position: relative;
            animation: catBlink 4s infinite;
        }
        .eye::after { content: ''; position: absolute; top: 3px; left: 3px; width: 5px; height: 5px; background: #fff; border-radius: 50%; }
        
        @keyframes catBlink { 0%, 96%, 100% { transform: scaleY(1); } 98% { transform: scaleY(0.1); } }

        /* Snout */
        .snout { margin-top: 2px; }
        .nose { width: 8px; height: 5px; background: #ffa07a; border-radius: 4px; margin: 0 auto; }
        .mouth {
            width: 16px; height: 8px; margin: 0 auto;
            border-bottom: 2px solid #000; border-radius: 0 0 10px 10px;
        }
        /* Cheek Blush */
        .blush {
            position: absolute; top: 12px; width: 10px; height: 6px; background: #ff9ff3; border-radius: 50%; opacity: 0.6;
        }
        .blush.left { left: 10px; } .blush.right { right: 10px; }


        /* --- Foreground Launch Effect (Rocket Layer) --- */
        #rocketLayer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 1000; overflow: hidden; }
        .squad-cat {
            position: absolute; bottom: -200px; /* Start below screen */
            /* Reusing the exact same structure via JS cloning */
            transform-origin: center;
        }

        /* --- Main App UI (คงเดิมตามสั่ง) --- */
        .app-container { width: 95%; max-width: 1200px; height: 90vh; background: var(--glass-surface); backdrop-filter: blur(30px); -webkit-backdrop-filter: blur(30px); border: 1px solid var(--glass-border); border-radius: 32px; box-shadow: 0 0 50px rgba(0, 242, 255, 0.1); display: flex; flex-direction: column; overflow: hidden; position: relative; z-index: 10; }
        header { padding: 25px 40px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--glass-border); background: rgba(0,0,0,0.3); }
        .brand h1 { margin: 0; font-size: 1.8rem; font-weight: 800; letter-spacing: 1px; text-transform: uppercase; background: linear-gradient(90deg, #fff, var(--neon-cyan)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .brand span { color: var(--neon-pink); font-size: 0.9rem; font-weight: 600; letter-spacing: 3px; margin-left: 10px; }
        .workspace { flex: 1; display: flex; flex-direction: column; position: relative; overflow: hidden; padding: 20px; }
        
        .drop-zone { flex: 1; border: 2px dashed rgba(255,255,255,0.15); border-radius: 24px; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; background: rgba(255,255,255,0.01); transition: all 0.4s ease; cursor: pointer; }
        .drop-zone:hover { border-color: var(--neon-cyan); background: rgba(0, 242, 255, 0.05); transform: scale(0.995); }
        .drop-icon { font-size: 80px; margin-bottom: 20px; filter: drop-shadow(0 0 20px var(--neon-cyan)); animation: bounce 2s infinite; }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
        
        .workspace.has-files { flex-direction: row; gap: 20px; }
        .workspace.has-files .drop-zone { flex: 0 0 250px; height: 100%; border: 1px solid var(--glass-border); background: rgba(0,0,0,0.2); }
        .workspace.has-files .drop-icon { font-size: 40px; margin-bottom: 10px; }
        .workspace.has-files .drop-text h3 { font-size: 1rem; }
        .workspace.has-files .drop-text p { font-size: 0.8rem; opacity: 0.7; }

        .list-area { flex: 1; background: rgba(0,0,0,0.2); border-radius: 24px; border: 1px solid var(--glass-border); overflow-y: auto; padding: 20px; opacity: 0; transition: 0.5s; }
        .workspace.has-files .list-area { opacity: 1; }

        .file-item { display: flex; align-items: center; padding: 15px 20px; margin-bottom: 10px; background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.05); border-radius: 12px; transition: 0.2s; }
        .file-item:hover { background: rgba(255,255,255,0.08); transform: translateX(5px); border-color: var(--neon-cyan); }
        .f-idx { font-family: var(--font-code); color: var(--neon-pink); font-weight: bold; width: 40px; font-size: 1.1rem; }
        .f-name { font-family: var(--font-code); color: #fff; font-size: 1rem; letter-spacing: 0.5px; }

        .control-bar { padding: 25px 40px; background: rgba(0,0,0,0.4); border-top: 1px solid var(--glass-border); display: flex; justify-content: space-between; align-items: center; }
        .btn { border: none; padding: 14px 32px; border-radius: 16px; font-family: var(--font-ui); font-weight: 800; font-size: 1rem; cursor: pointer; transition: 0.3s; display: flex; align-items: center; gap: 10px; text-transform: uppercase; letter-spacing: 1px; }
        .btn-clear { background: rgba(255, 50, 50, 0.1); color: #ff5555; border: 1px solid rgba(255, 50, 50, 0.3); }
        .btn-clear:hover { background: rgba(255, 50, 50, 0.2); box-shadow: 0 0 20px rgba(255, 50, 50, 0.2); }
        .btn-copy { background: linear-gradient(135deg, var(--neon-cyan), #006aff); color: #000; box-shadow: 0 0 30px rgba(0, 242, 255, 0.4); position: relative; overflow: hidden; font-size: 1.2rem; }
        .btn-copy:hover { transform: translateY(-3px); box-shadow: 0 0 50px rgba(0, 242, 255, 0.6); }
        .btn-copy:active { transform: scale(0.95); }

        .toggle-btn { display: flex; align-items: center; gap: 10px; cursor: pointer; padding: 10px 20px; border-radius: 50px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); transition: 0.3s; }
        .toggle-btn.active { border-color: var(--neon-cyan); background: rgba(0, 242, 255, 0.1); }
        .t-dot { width: 12px; height: 12px; background: #555; border-radius: 50%; transition: 0.3s; }
        .toggle-btn.active .t-dot { background: var(--neon-cyan); box-shadow: 0 0 10px var(--neon-cyan); }
        #hiddenOutput { position: absolute; left: -9999px; }

        

        /* --- 1. EFFECTS (คงเดิม) --- */
    @keyframes glitch-anim-1 {
        0% { clip-path: inset(20% 0 80% 0); transform: translate(-2px, 1px); }
        20% { clip-path: inset(60% 0 10% 0); transform: translate(2px, -1px); }
        40% { clip-path: inset(40% 0 50% 0); transform: translate(-2px, 2px); }
        60% { clip-path: inset(80% 0 5% 0); transform: translate(2px, -2px); }
        80% { clip-path: inset(10% 0 70% 0); transform: translate(-1px, 1px); }
        100% { clip-path: inset(30% 0 60% 0); transform: translate(1px, -1px); }
    }
    .glitch-active { position: relative; }
    .glitch-active::before, .glitch-active::after {
        content: attr(data-text); position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg-deep);
    }
    .glitch-active::before {
        left: 2px; text-shadow: -1px 0 #ff00de; clip: rect(24px, 550px, 90px, 0);
        animation: glitch-anim-1 0.3s infinite linear alternate-reverse;
    }
    .glitch-active::after {
        left: -2px; text-shadow: -1px 0 #00f2ff; clip: rect(85px, 550px, 140px, 0);
        animation: glitch-anim-1 0.3s infinite linear alternate-reverse; animation-delay: -0.1s;
    }

    /* --- 2. DROP ZONE WARP (คงเดิม) --- */
    .drop-zone.warp-active {
        border-color: var(--neon-pink) !important;
        background: rgba(255, 0, 222, 0.15) !important;
        box-shadow: 0 0 50px var(--neon-pink), inset 0 0 20px var(--neon-pink);
        transform: scale(1.02);
    }
    .drop-zone.warp-active .drop-icon { animation: spinHole 0.5s infinite linear !important; font-size: 100px; color: var(--neon-pink); }
    @keyframes spinHole { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

    /* --- 3. MOUSE TRAIL (คงเดิม) --- */
    .mouse-particle {
        position: absolute; pointer-events: none; z-index: 9999; width: 6px; height: 6px; border-radius: 50%;
        background: white; box-shadow: 0 0 6px white; animation: fadeParticle 0.6s forwards;
    }
    @keyframes fadeParticle { 0% { opacity: 1; transform: scale(1); } 100% { opacity: 0; transform: scale(0) translate(0, 20px); } }

    /* --- 4. SHAKE (คงเดิม) --- */
    .shake-hard { animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both; }
    @keyframes shake {
        10%, 90% { transform: translate3d(-2px, 2px, 0) rotate(1deg); }
        20%, 80% { transform: translate3d(4px, -4px, 0) rotate(-1deg); }
        30%, 50%, 70% { transform: translate3d(-8px, 6px, 0) rotate(2deg); }
        40%, 60% { transform: translate3d(8px, -6px, 0) rotate(-2deg); }
    }

    /* --- 5. NYAN STORM (แก้ใหม่ให้เห็นชัดๆ) --- */
    .nyan-boom {
        position: fixed; /* ใช้ fixed เพื่อให้หลุดจาก container เดิม */
        z-index: 10000; /* ทับทุกเลเยอร์ */
        width: 120px; /* บังคับขนาดให้ใหญ่พอ */
        height: 140px;
        pointer-events: none;
        will-change: transform;
        /* เริ่มต้นที่จุดกลาง (จะถูก override ด้วย JS) */
        left: 0; top: 0;
    }
    
    /* อนิเมชั่นแมวบินว่อน */
    @keyframes chaosFly {
        0% {
            opacity: 1;
            transform: translate(-50%, -50%) scale(0.2) rotate(0deg);
        }
        20% {
             /* ขยายตัวอย่างรวดเร็ว */
            transform: translate(-50%, -50%) scale(1.5) rotate(var(--rot-start));
        }
        100% {
            opacity: 0;
            /* บินไปตามทิศทางที่สุ่มไว้ (tx, ty) + หมุนติ้ว (rot-end) */
            transform: translate(var(--tx), var(--ty)) scale(0) rotate(var(--rot-end));
        }
    }

    /* --- Nyan-Orb Animation (Lightweight) --- */
    .planet-container {
        position: relative;
        width: 80px;
        height: 80px;
        display: flex;
        justify-content: center;
        align-items: center;
    }

    /* วงแหวนพลังงานหมุนๆ */
    .planet-ring {
        position: absolute;
        width: 100%;
        height: 100%;
        border-radius: 50%;
        border: 2px solid transparent;
        border-top-color: var(--neon-cyan);
        border-bottom-color: var(--neon-pink);
        animation: spinRing 2s linear infinite;
        box-shadow: 0 0 10px rgba(0, 242, 255, 0.3);
    }

    .planet-ring::before {
        content: '';
        position: absolute;
        top: 5px; left: 5px; right: 5px; bottom: 5px;
        border-radius: 50%;
        border: 2px solid transparent;
        border-left-color: var(--neon-pink);
        border-right-color: var(--neon-cyan);
        animation: spinRing 3s linear infinite reverse;
    }

    /* ตัวดาวแมว */
    .planet-body {
        position: absolute;
        width: 50px;
        height: 50px;
        background: radial-gradient(circle at 30% 30%, var(--neon-cyan), #000);
        border-radius: 50%;
        box-shadow: inset -5px -5px 10px rgba(0,0,0,0.5), 0 0 15px var(--neon-cyan);
        animation: pulseOrb 2s ease-in-out infinite alternate;
    }

    /* หูแมวที่งอกออกมาจากดาว */
    .cat-ear {
        position: absolute;
        top: -8px;
        width: 0;
        height: 0;
        border-left: 10px solid transparent;
        border-right: 10px solid transparent;
        border-bottom: 15px solid var(--neon-cyan);
        filter: drop-shadow(0 0 5px var(--neon-cyan));
    }
    .cat-ear.left { left: 5px; transform: rotate(-25deg); }
    .cat-ear.right { right: 5px; transform: rotate(25deg); }

    /* Animation Keyframes */
    @keyframes spinRing {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    @keyframes pulseOrb {
        0% { transform: scale(0.95); box-shadow: 0 0 10px var(--neon-cyan); }
        100% { transform: scale(1.05); box-shadow: 0 0 25px var(--neon-cyan), 0 0 10px var(--neon-pink); }
    }
    
    
    
    </style>
</head>
<body>
    <canvas id="starCanvas"></canvas>
    <div class="nebula"></div>
    <div id="astroLayer"></div>
    <div id="rocketLayer"></div>

    <div class="app-container">
        <header>
            <div class="brand"><h1>RCP Extractor</h1><span>CAT CAT CAT CAT</span></div>
            <div class="toggle-btn" id="extToggle" onclick="toggleExt()"><div class="t-dot"></div><span style="font-weight: 600;">Keep .mp4</span></div>
        </header>
        <div class="workspace" id="workspace">
            <div class="drop-zone" id="dropZone">
                <div class="drop-icon">
                    <div class="planet-container">
                        <div class="planet-ring"></div>
                        <div class="planet-body">
                            <div class="cat-ear left"></div>
                            <div class="cat-ear right"></div>
                        </div>
                    </div>
                </div>
                <div class="drop-text">
                    <h3>Drag Files Here</h3>
                    <p>Cats will take over the world</p>
                </div>
                <input type="file" id="fileInput" multiple style="display:none">
            </div>
            
            <div class="list-area">
                <div id="fileListDisplay"></div>
            </div>
        </div>
        <textarea id="hiddenOutput"></textarea>
        <div class="control-bar">
            <div style="font-family: var(--font-code); color: var(--text-muted);" id="fileCount">WAITING FOR Video...</div>
            <div style="display: flex; gap: 15px;"><button class="btn btn-clear" onclick="clearText()">CLEAR</button><button class="btn btn-copy" id="copyBtn" onclick="copyText()">COPY</button></div>
        </div>
    </div>

<template id="nyanTemplate">
    <div class="nyan-box">
        <div class="jetpack"><div class="thruster left"></div><div class="thruster right"></div><div class="flame left"></div><div class="flame right"></div></div>
        <div class="limb arm left"></div><div class="limb arm right"></div>
        <div class="limb leg left"></div><div class="limb leg right"></div>
        <div class="suit-body"><div class="chest-panel"></div></div>
        <div class="helmet">
            <div class="visor-glass">
                <div class="reflection"></div>
                <div class="cat-head">
                    <div class="cat-ears"><div class="ear left"></div><div class="ear right"></div></div>
                    <div class="stripe"></div>
                    <div class="face-features">
                        <div class="eyes-row"><div class="eye"></div><div class="eye"></div></div>
                        <div class="snout"><div class="nose"></div><div class="mouth"></div></div>
                        <div class="blush left"></div><div class="blush right"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</template>

<script>

    // --- 1. MOUSE TRAIL ---
    const colors = ['#00f2ff', '#ff00de', '#ffffff', '#ffd700'];
    document.addEventListener('mousemove', (e) => {
        if(Math.random() > 0.6) return; // ลดจำนวนลงหน่อยจะได้ไม่แลค
        const p = document.createElement('div');
        p.className = 'mouse-particle';
        p.style.left = e.pageX + 'px'; p.style.top = e.pageY + 'px';
        p.style.background = colors[Math.floor(Math.random() * colors.length)];
        p.style.boxShadow = `0 0 10px ${p.style.background}`;
        document.body.appendChild(p);
        setTimeout(() => p.remove(), 600);
    });

    // --- 2. GLITCH TITLE ---
    const titleH1 = document.querySelector('.brand h1');
    titleH1.setAttribute('data-text', titleH1.innerText);
    setInterval(() => {
        if(Math.random() > 0.75) {
            titleH1.classList.add('glitch-active');
            setTimeout(() => titleH1.classList.remove('glitch-active'), 200 + Math.random() * 300);
        }
    }, 2500);

    // --- 3. DROP ZONE & NYAN EXPLOSION (แก้ใหม่) ---
    const dz = document.getElementById('dropZone');
    const nyanTemplate = document.getElementById('nyanTemplate');

    dz.addEventListener('dragenter', () => dz.classList.add('warp-active'));
    dz.addEventListener('dragleave', () => dz.classList.remove('warp-active'));
    
    dz.addEventListener('drop', (e) => {
        dz.classList.remove('warp-active');
        // เรียกแมวระเบิด ณ จุดที่เมาส์ปล่อย
        spawnNyanStorm(e.clientX, e.clientY);
    });
    
    // Support การกด Browse ไฟล์ด้วย
    document.getElementById('fileInput').addEventListener('change', () => {
        const rect = dz.getBoundingClientRect();
        // ให้ระเบิดกลางจอ
        spawnNyanStorm(rect.left + rect.width/2, rect.top + rect.height/2);
    });

    function spawnNyanStorm(x, y) {
        // จำนวนแมว (เบิ้มๆ)
        const count = 30; 
        
        for (let i = 0; i < count; i++) {
            const wrapper = document.createElement('div');
            wrapper.className = 'nyan-boom';
            
            // ตั้งตำแหน่งเริ่มต้นที่เมาส์
            wrapper.style.left = x + 'px';
            wrapper.style.top = y + 'px';

            // Clone รูปแมวจาก Template เดิม
            const clone = nyanTemplate.content.cloneNode(true);
            wrapper.appendChild(clone);

            // คำนวณทิศทางสุ่มแบบ 360 องศา
            const angle = Math.random() * Math.PI * 2;
            const velocity = 200 + Math.random() * 600; // ความไกลที่จะบินไป (px)
            const tx = Math.cos(angle) * velocity + 'px'; // ปลายทาง X
            const ty = Math.sin(angle) * velocity + 'px'; // ปลายทาง Y
            
            // สุ่มการหมุน
            const rotStart = (Math.random() * 40 - 20) + 'deg';
            const rotEnd = (Math.random() * 720 - 360) + 'deg'; // หมุน 1-2 รอบ

            // ส่งค่าเข้า CSS Variables
            wrapper.style.setProperty('--tx', tx);
            wrapper.style.setProperty('--ty', ty);
            wrapper.style.setProperty('--rot-start', rotStart);
            wrapper.style.setProperty('--rot-end', rotEnd);

            // กำหนดความเร็วอนิเมชั่น (ไม่พร้อมกัน ให้ดู chaotic)
            const duration = 0.8 + Math.random() * 0.5;
            wrapper.style.animation = `chaosFly ${duration}s cubic-bezier(0.1, 0.7, 0.1, 1) forwards`;

            document.body.appendChild(wrapper);

            // ลบเมื่อเล่นเสร็จ
            setTimeout(() => wrapper.remove(), duration * 1000);
        }
    }

    // --- 4. ROCKET LAUNCH SHAKE (แก้ตามสั่ง: ไม่เอาแสงขาว) ---
    const originalCopy = window.copyText;
    window.copyText = function() {
        originalCopy(); 

        // สั่นอย่างเดียว
        const container = document.querySelector('.app-container');
        container.classList.add('shake-hard');
        
        // บิดสีนิดหน่อยให้รู้ว่ากด
        document.body.style.filter = 'contrast(1.4) saturate(1.5)';

        setTimeout(() => {
            container.classList.remove('shake-hard');
            document.body.style.filter = '';
        }, 500);
    };
    // --- APP LOGIC (UNCHANGED) ---
    const dropZone = document.getElementById('dropZone'), fileInput = document.getElementById('fileInput'), workspace = document.getElementById('workspace'), fileListDisplay = document.getElementById('fileListDisplay'), hiddenOutput = document.getElementById('hiddenOutput'), extToggle = document.getElementById('extToggle'), copyBtn = document.getElementById('copyBtn'), fileCount = document.getElementById('fileCount');
    let currentFiles = [], includeExt = false;
    function toggleExt() { includeExt = !includeExt; extToggle.classList.toggle('active'); reProcess(); }
    dropZone.addEventListener('click', () => fileInput.click());
    dropZone.addEventListener('dragover', (e) => { e.preventDefault(); dropZone.style.borderColor = '#00f2ff'; dropZone.style.background = 'rgba(0,242,255,0.1)'; });
    dropZone.addEventListener('dragleave', () => { dropZone.style.borderColor = ''; dropZone.style.background = ''; });
    dropZone.addEventListener('drop', (e) => { e.preventDefault(); dropZone.style.borderColor = ''; dropZone.style.background = ''; handleFiles(e.dataTransfer.files); });
    fileInput.addEventListener('change', (e) => { handleFiles(e.target.files); fileInput.value = ''; });
    function handleFiles(files) { if (files.length === 0) return; currentFiles = Array.from(files); renderUI(); }
    function renderUI() {
        if (currentFiles.length > 0) { workspace.classList.add('has-files'); fileCount.innerHTML = `DETECTED: <span style="color:var(--neon-cyan)">${currentFiles.length} OBJECTS</span>`; } else { workspace.classList.remove('has-files'); fileListDisplay.innerHTML = ''; fileCount.innerText = 'WAITING FOR Video...'; return; }
        const nameList = currentFiles.map(file => { let name = file.name; if (!includeExt) name = name.substring(0, name.lastIndexOf('.')) || name; return name; });
        hiddenOutput.value = nameList.join('\n'); fileListDisplay.innerHTML = '';
        nameList.forEach((name, index) => { const item = document.createElement('div'); item.className = 'file-item'; item.style.animation = `slideIn 0.3s forwards ${index * 0.05}s`; item.style.opacity = '0'; item.innerHTML = `<span class="f-idx">${index + 1}</span><span class="f-name">${name}</span>`; fileListDisplay.appendChild(item); });
        if(!document.getElementById('slideInStyle')) { const style = document.createElement('style'); style.id = 'slideInStyle'; style.innerHTML = `@keyframes slideIn { from { opacity:0; transform:translateX(-10px); } to { opacity:1; transform:translateX(0); } }`; document.head.appendChild(style); }
    }
    function reProcess() { if (currentFiles.length > 0) renderUI(); }
    function copyText() { if (!hiddenOutput.value) return; hiddenOutput.select(); document.execCommand('copy'); hiddenOutput.setSelectionRange(0, 0); launchCatSquadron(); }
    function clearText() { currentFiles = []; renderUI(); }

    // --- BACKGROUND STARS ---
    const canvas = document.getElementById('starCanvas'), ctx = canvas.getContext('2d'); let width, height, stars = [];
    function initStars() { width = window.innerWidth; height = window.innerHeight; canvas.width = width; canvas.height = height; stars = []; for(let i=0; i<200; i++) stars.push({ x: Math.random()*width, y: Math.random()*height, size: Math.random()*2, speed: Math.random()*0.2 + 0.05 }); }
    function animateStars() { ctx.clearRect(0, 0, width, height); ctx.fillStyle = 'white'; stars.forEach(star => { ctx.globalAlpha = Math.random()*0.5+0.5; ctx.beginPath(); ctx.arc(star.x, star.y, star.size, 0, Math.PI*2); ctx.fill(); star.y -= star.speed; if(star.y < 0) star.y = height; }); requestAnimationFrame(animateStars); }
    window.addEventListener('resize', initStars); initStars(); animateStars();

    // --- CSS ASTRO-NYAN GENERATOR ---
    const astroLayer = document.getElementById('astroLayer');
    const template = document.getElementById('nyanTemplate');

    function spawnBackgroundCats() {
        // Spawn 15 Floating Cats
        for(let i=0; i<15; i++) {
            createFloatingNyan();
        }
    }

    function createFloatingNyan() {
        const wrapper = document.createElement('div');
        wrapper.className = 'astro-nyan-wrapper';
        
        // Clone CSS Art
        const clone = template.content.cloneNode(true);
        wrapper.appendChild(clone);

        // Random Properties
        const scale = Math.random() * 0.4 + 0.3; // Scale 0.3 - 0.7
        wrapper.style.transform = `scale(${scale})`;
        wrapper.style.opacity = Math.random() * 0.5 + 0.4;
        
        // Random Animation
        const duration = Math.random() * 40 + 30; // 30s - 70s float
        const animName = `float_${Math.random().toString(36).substr(2, 9)}`;
        const startX = Math.random() * 100;
        const startY = Math.random() * 100;
        
        const keyframes = `
            @keyframes ${animName} {
                0% { transform: translate(${Math.random()*100}vw, ${Math.random()*100}vh) rotate(-10deg) scale(${scale}); }
                33% { transform: translate(${Math.random()*100}vw, ${Math.random()*100}vh) rotate(15deg) scale(${scale}); }
                66% { transform: translate(${Math.random()*100}vw, ${Math.random()*100}vh) rotate(-20deg) scale(${scale}); }
                100% { transform: translate(${Math.random()*100}vw, ${Math.random()*100}vh) rotate(10deg) scale(${scale}); }
            }
        `;
        const styleSheet = document.createElement("style"); styleSheet.innerText = keyframes; document.head.appendChild(styleSheet);
        
        wrapper.style.animation = `${animName} ${duration}s infinite linear alternate`;
        astroLayer.appendChild(wrapper);
    }

    spawnBackgroundCats();

    // --- LAUNCH EFFECT (SQUAD) ---
    function launchCatSquadron() {
        const rocketLayer = document.getElementById('rocketLayer');
        const squadSize = 20;

        for (let i = 0; i < squadSize; i++) {
            setTimeout(() => {
                const wrapper = document.createElement('div');
                wrapper.className = 'squad-cat'; // Absolute positioned at bottom
                wrapper.style.width = '120px'; wrapper.style.height = '150px'; // Set base size
                
                // Clone the same CSS Art for uniformity
                const clone = template.content.cloneNode(true);
                wrapper.appendChild(clone);
                
                // Randomize Launch
                const leftPos = Math.random() * 90 + 5;
                wrapper.style.left = `${leftPos}%`;
                
                const scale = Math.random() * 0.5 + 0.5; // Bigger than background
                // We set transform in animation, but need initial scale
                
                rocketLayer.appendChild(wrapper);

                const speed = Math.random() * 1500 + 1000; // 1s - 2.5s
                const rot = Math.random() * 40 - 20; // -20 to 20 deg tilt

                const animation = wrapper.animate([
                    { transform: `translate(-50%, 100vh) scale(${scale}) rotate(0deg)`, opacity: 0 },
                    { transform: `translate(-50%, 50vh) scale(${scale}) rotate(${rot}deg)`, opacity: 1, offset: 0.2 },
                    { transform: `translate(-50%, -120vh) scale(${scale * 1.2}) rotate(${rot * 2}deg)`, opacity: 1 }
                ], { duration: speed, easing: 'cubic-bezier(0.2, 0.8, 0.2, 1)' });

                animation.onfinish = () => wrapper.remove();
            }, i * 60);
        }

        const oldText = copyBtn.innerHTML; copyBtn.innerHTML = 'Wiiiiiii!!'; copyBtn.style.background = 'var(--neon-pink)';
        setTimeout(() => { copyBtn.innerHTML = oldText; copyBtn.style.background = ''; }, 2000);
    }
</script>
</body>
</html>
